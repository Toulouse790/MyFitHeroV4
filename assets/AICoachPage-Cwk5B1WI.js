import{r as t,j as e}from"./index-CjnEZlsY.js";import{c as E}from"./clsx-B-dksMZM.js";import{A as D,a as T}from"./index-BWjCeQlA.js";import{t as k}from"./index-GGMoTRFm.js";import{M as V,u as M,P as $,a as q,b as K,L as U,m as z}from"./proxy-BMX__oQJ.js";import"./iconBase-BriXq5B3.js";class B extends t.Component{getSnapshotBeforeUpdate(s){const r=this.props.childRef.current;if(r&&s.isPresent&&!this.props.isPresent){const a=this.props.sizeRef.current;a.height=r.offsetHeight||0,a.width=r.offsetWidth||0,a.top=r.offsetTop,a.left=r.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function J({children:n,isPresent:s}){const r=t.useId(),a=t.useRef(null),i=t.useRef({width:0,height:0,top:0,left:0}),{nonce:d}=t.useContext(V);return t.useInsertionEffect(()=>{const{width:m,height:c,top:p,left:o}=i.current;if(s||!a.current||!m||!c)return;a.current.dataset.motionPopId=r;const u=document.createElement("style");return d&&(u.nonce=d),document.head.appendChild(u),u.sheet&&u.sheet.insertRule(`
          [data-motion-pop-id="${r}"] {
            position: absolute !important;
            width: ${m}px !important;
            height: ${c}px !important;
            top: ${p}px !important;
            left: ${o}px !important;
          }
        `),()=>{document.head.removeChild(u)}},[s]),e.jsx(B,{isPresent:s,childRef:a,sizeRef:i,children:t.cloneElement(n,{ref:a})})}const O=({children:n,initial:s,isPresent:r,onExitComplete:a,custom:i,presenceAffectsLayout:d,mode:m})=>{const c=M(Q),p=t.useId(),o=t.useCallback(x=>{c.set(x,!0);for(const h of c.values())if(!h)return;a&&a()},[c,a]),u=t.useMemo(()=>({id:p,initial:s,isPresent:r,custom:i,onExitComplete:o,register:x=>(c.set(x,!1),()=>c.delete(x))}),d?[Math.random(),o]:[r,o]);return t.useMemo(()=>{c.forEach((x,h)=>c.set(h,!1))},[r]),t.useEffect(()=>{!r&&!c.size&&a&&a()},[r]),m==="popLayout"&&(n=e.jsx(J,{isPresent:r,children:n})),e.jsx($.Provider,{value:u,children:n})};function Q(){return new Map}const R=n=>n.key||"";function P(n){const s=[];return t.Children.forEach(n,r=>{t.isValidElement(r)&&s.push(r)}),s}const H=({children:n,custom:s,initial:r=!0,onExitComplete:a,presenceAffectsLayout:i=!0,mode:d="sync",propagate:m=!1})=>{const[c,p]=q(m),o=t.useMemo(()=>P(n),[n]),u=m&&!c?[]:o.map(R),x=t.useRef(!0),h=t.useRef(o),g=M(()=>new Map),[A,j]=t.useState(o),[w,I]=t.useState(o);K(()=>{x.current=!1,h.current=o;for(let b=0;b<w.length;b++){const f=R(w[b]);u.includes(f)?g.delete(f):g.get(f)!==!0&&g.set(f,!1)}},[w,u.length,u.join("-")]);const v=[];if(o!==A){let b=[...o];for(let f=0;f<w.length;f++){const C=w[f],l=R(C);u.includes(l)||(b.splice(f,0,C),v.push(C))}d==="wait"&&v.length&&(b=v),I(P(b)),j(o);return}const{forceRender:S}=t.useContext(U);return e.jsx(e.Fragment,{children:w.map(b=>{const f=R(b),C=m&&!c?!1:o===w||u.includes(f),l=()=>{if(g.has(f))g.set(f,!0);else return;let y=!0;g.forEach(N=>{N||(y=!1)}),y&&(S==null||S(),I(h.current),m&&(p==null||p()),a&&a())};return e.jsx(O,{isPresent:C,initial:!x.current||r?void 0:!1,custom:C?void 0:s,presenceAffectsLayout:i,mode:d,onExitComplete:C?void 0:l,children:b},f)})})};async function G(n){return await new Promise(s=>setTimeout(s,1500)),"R√©ponse IA simul√©e bas√©e sur le contexte et messages..."}async function L(n){return await new Promise(s=>setTimeout(s,1e3)),{postureScore:85,warning:"",caloriesBurned:12}}async function _(){return{workouts:["S√©ance full body","Cardio HIIT"],nutrition:{calories:2200,macros:{protein:150,carbs:250,fat:70}},hydration:{dailyLiters:2.5},sleep:{hours:7.5}}}const W=()=>{const[n,s]=t.useState(""),[r,a]=t.useState(!1),i=t.useRef(null),d=!!(window.SpeechRecognition||window.webkitSpeechRecognition);t.useEffect(()=>{if(!d)return;const p=window.SpeechRecognition||window.webkitSpeechRecognition;i.current=new p,i.current.continuous=!1,i.current.interimResults=!1,i.current.lang="fr-FR",i.current.onresult=o=>{if(o.results.length>0){const u=o.results[0][0].transcript;s(u)}},i.current.onend=()=>a(!1),i.current.onerror=o=>{console.error("Recognition error",o),k.error("Erreur micro, veuillez r√©essayer."),a(!1)}},[d]);const m=t.useCallback(()=>{!d||!i.current||(s(""),a(!0),i.current.start())},[d]),c=t.useCallback(()=>{!d||!i.current||(i.current.stop(),a(!1))},[d]);return{text:n,isListening:r,listen:m,stopListening:c,voiceSupported:d}},X=t.memo(({title:n,subtitle:s})=>e.jsxs("header",{className:"bg-blue-700 dark:bg-blue-900 text-white p-4 shadow-md sticky top-0 z-30",children:[e.jsx("h1",{className:"text-3xl font-semibold",children:n}),s&&e.jsx("p",{className:"text-sm opacity-80",children:s})]})),Y=({count:n,className:s})=>e.jsx(e.Fragment,{children:Array.from({length:n}).map((r,a)=>e.jsx("div",{className:E("bg-gray-300 animate-pulse rounded-md my-1",s)},a))}),Z=({role:n,content:s})=>{const r=n==="user";return e.jsx(z.div,{initial:{opacity:0,x:r?50:-50},animate:{opacity:1,x:0},exit:{opacity:0},className:E("max-w-[75%] p-3 rounded-lg mb-2 whitespace-pre-wrap",r?"bg-blue-600 text-white self-end":"bg-gray-200 text-gray-900 self-start","shadow-sm"),role:"article","aria-label":r?"Message utilisateur":"Message assistant AI",children:s})},ee=({onAction:n})=>e.jsxs("section",{"aria-label":"Actions rapides pour coach IA",className:"flex justify-around bg-gray-100 dark:bg-gray-800 p-3 rounded-lg shadow-inner",children:[e.jsx("button",{onClick:()=>n("planJour"),className:"bg-green-600 text-white px-4 py-2 rounded-md hover:bg-green-700 focus:ring-2 focus:ring-green-400","aria-label":"G√©n√©rer plan du jour",children:"Plan du jour"}),e.jsx("button",{onClick:()=>n("ajusterCharge"),className:"bg-yellow-600 text-white px-4 py-2 rounded-md hover:bg-yellow-700 focus:ring-2 focus:ring-yellow-400","aria-label":"Ajuster charge",children:"Ajuster charge"}),e.jsx("button",{onClick:()=>n("analyserForme"),className:"bg-purple-600 text-white px-4 py-2 rounded-md hover:bg-purple-700 focus:ring-2 focus:ring-purple-400","aria-label":"Analyser forme",children:"Analyser forme"})]}),te=({videoRef:n,exerciseAnalysis:s,isLiveCoaching:r})=>e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("video",{ref:n,autoPlay:!0,muted:!0,playsInline:!0,className:"rounded-lg shadow-md border w-full max-w-md aspect-video bg-black","aria-label":"Flux vid√©o pour analyse de la forme"}),r?e.jsx("p",{className:"mt-2 text-green-600 font-semibold",children:"Coaching live activ√©"}):e.jsx("p",{className:"mt-2 text-gray-500 italic",children:"Coaching live d√©sactiv√©"}),s&&e.jsxs("div",{className:"mt-4 text-sm bg-gray-100 dark:bg-gray-800 p-3 rounded-lg w-full max-w-md shadow-inner",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Score posture:"})," ",s.postureScore,"%"]}),s.warning&&e.jsxs("p",{className:"text-red-600 font-semibold",children:["‚ö†Ô∏è ",s.warning]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Calories estim√©es br√ªl√©es:"})," ",s.caloriesBurned]})]})]}),se=()=>{const[n,s]=t.useState([]),[r,a]=t.useState(""),[i,d]=t.useState(!1),[m,c]=t.useState(null),[p,o]=t.useState(null),[u,x]=t.useState(!1),h=t.useRef(null),{text:g,isListening:A,listen:j,stopListening:w,voiceSupported:I}=W(),v=t.useCallback(async l=>{if(!l.trim())return;const y={role:"user",content:l};s(N=>[...N,y]),d(!0);try{const N=await G({messages:[...n,y]});s(F=>[...F,{role:"assistant",content:N}])}catch{k.error("Erreur communication IA.")}finally{d(!1)}},[n]);t.useEffect(()=>{g&&!A&&(v(g),a(""))},[g,A,v]);const S=t.useCallback(l=>{a(l.target.value)},[]),b=t.useCallback(l=>{l.key==="Enter"&&r.trim()&&(v(r),a(""))},[r,v]),f=t.useCallback(async l=>{if(l==="planJour")try{const y=await _();o(y),k.success("Plan personnalis√© g√©n√©r√©.")}catch{k.error("Erreur lors g√©n√©ration plan.")}else if(l==="ajusterCharge")k.info("Fonction Ajuster Charge en d√©veloppement.");else if(l==="analyserForme"){if(!h.current){k.error("Vid√©o non disponible.");return}try{const y=await L(h.current);c(y),k.success("Analyse forme termin√©e.")}catch{k.error("Erreur analyse video.")}}},[]);t.useEffect(()=>{let l=null;const y=async()=>{if(h.current){try{const N=await L(h.current);c(N)}catch{}l=requestAnimationFrame(y)}};return u?y():l&&cancelAnimationFrame(l),()=>{l&&cancelAnimationFrame(l)}},[u]);const C=t.useCallback(()=>x(l=>!l),[]);return{messages:n,input:r,isStreaming:i,onChangeInput:S,onKeyDownInput:b,sendMessage:v,voiceSupported:I,isListening:A,listen:j,stopListening:w,onExecuteQuickAction:f,exerciseAnalysis:m,personalPlan:p,videoRef:h,isLiveCoaching:u,toggleLiveCoaching:C}},re=()=>{const{messages:n,input:s,isStreaming:r,onChangeInput:a,onKeyDownInput:i,voiceSupported:d,isListening:m,listen:c,stopListening:p,onExecuteQuickAction:o,exerciseAnalysis:u,personalPlan:x,videoRef:h,isLiveCoaching:g,toggleLiveCoaching:A}=se();return e.jsxs("div",{className:"min-h-screen bg-white dark:bg-gray-900 text-gray-900 dark:text-gray-100 flex flex-col",children:[e.jsx(X,{title:"AI Coach",subtitle:"Votre coach fitness intelligent"}),e.jsxs("main",{className:"flex-grow max-w-4xl mx-auto p-4 grid gap-8",children:[e.jsx(ee,{onAction:o}),e.jsxs("section",{"aria-label":"Chat conversation avec AI Coach",className:"flex flex-col border rounded-lg p-4 min-h-[400px] bg-white dark:bg-gray-900 shadow",role:"log","aria-live":"polite","aria-relevant":"additions",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto space-y-4 scrollbar-thin scrollbar-thumb-gray-400 scrollbar-track-gray-200 dark:scrollbar-thumb-gray-700 dark:scrollbar-track-gray-800",children:[n.length===0&&!r&&e.jsx(Y,{count:3,className:"h-10 rounded-md"}),e.jsxs(H,{initial:!1,children:[n.map((j,w)=>e.jsx(Z,{role:j.role,content:j.content},w)),r&&e.jsxs(z.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"italic text-gray-500 dark:text-gray-400","aria-live":"assertive",children:[e.jsx(D,{className:"inline animate-spin mr-1"}),"L'IA r√©dige..."]})]})]}),e.jsxs("form",{onSubmit:j=>{j.preventDefault(),s.trim()&&o("planJour")},className:"flex items-center mt-2","aria-label":"Envoyer un message au coach AI",children:[e.jsx("input",{type:"text","aria-label":"Votre question ou message",placeholder:"Posez une question ou dites quelque chose...",value:s,onChange:a,onKeyDown:i,disabled:r,className:"flex-grow p-2 border border-gray-300 dark:border-gray-600 rounded-l-md dark:bg-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-blue-500"}),d&&e.jsx("button",{type:"button","aria-pressed":m,onClick:m?p:c,title:m?"Arr√™ter l'√©coute vocale":"Activer l'√©coute vocale",className:E("px-3 py-2 border border-l-0 rounded-r-md focus:outline-none",m?"bg-red-600 text-white":"bg-gray-300 dark:bg-gray-700"),children:"üé§"}),e.jsx("button",{type:"submit",disabled:r||s.trim()==="","aria-disabled":r||s.trim()==="",title:"Envoyer",className:"px-4 py-2 bg-blue-600 text-white rounded-r-md hover:bg-blue-700 focus:ring-2 focus:ring-blue-500",children:e.jsx(T,{size:20})})]})]}),e.jsxs("section",{"aria-label":"Analyse vid√©o de la forme d'exercice",className:"border rounded-lg p-4 bg-white dark:bg-gray-900 shadow flex flex-col items-center",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Analyse vid√©o"}),e.jsx(te,{videoRef:h,exerciseAnalysis:u,isLiveCoaching:g}),e.jsx("button",{onClick:A,"aria-pressed":g,className:E("mt-3 px-4 py-2 rounded-md focus:outline-none",g?"bg-green-600 text-white":"bg-gray-300 dark:bg-gray-700"),children:g?"Arr√™ter le coaching live":"D√©marrer coaching live"})]}),x&&e.jsxs("section",{"aria-label":"Plan personnalis√© g√©n√©r√©",className:"border rounded-lg p-4 bg-white dark:bg-gray-900 shadow max-w-4xl overflow-auto",children:[e.jsx("h2",{className:"text-lg font-semibold mb-2",children:"Plan personnalis√©"}),e.jsx("pre",{className:"text-xs whitespace-pre-wrap",children:JSON.stringify(x,null,2)})]})]})]})},ue=t.memo(re);export{ue as default};
//# sourceMappingURL=AICoachPage-Cwk5B1WI.js.map
